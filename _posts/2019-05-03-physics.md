---
layout: post
title: Applying Gravity
---

Alex implemented some mechanical physics helper functions for me to simulate simple gravity on the metaballs. Some of the functions are shown here:

```c++
/////////// PHYSICS HELPERS ////////////

// Apply a force to the object. This factors in mass. A bigger mass means a bigger force is needed to yield the same change in velocity.
void ApplyForce(glm::vec3 force, float deltaTime)
{
    ApplyAcceleration(force/mass, deltaTime);
}

// Apply an acceleration to the object. Useful for uniform forces like gravity, where the object's mass does not matter.
void ApplyAcceleration(glm::vec3 acceleration, float deltaTime)
{
    velocity += acceleration * deltaTime;
}

// Restrict the velocity to a maximum value
void LimitVelocity(float terminalVelocity)
{
    float vMin = glm::min(glm::length(velocity), terminalVelocity);
    velocity = glm::normalize(velocity)*vMin;
}

// Reflect the velocity vector along the given surface normal.
// The elasicity property determines how much energy is preserved after the collision, and should be between 0.0 -> 1.0.
void Bounce(glm::vec3 surfaceNormal, float elasticity)
{
    surfaceNormal = glm::normalize(surfaceNormal);
    glm::vec3 normalProjected = glm::dot(velocity, surfaceNormal) * surfaceNormal;
    glm::vec3 newDir = velocity - 2.0f*normalProjected;
    velocity = newDir * elasticity;
}
```

We programmed the scalar field boundary such that the every surrounding planes will bounce the metaballs in the opposite direction with elastic collision. The result would be like this:

![]({{ site.baseurl }}/images/physics-2.gif)

Adjusting some force and collision parameters, the closest result we can get to a liquid was this:

![]({{ site.baseurl }}/images/physics-3.gif)

In the next update, we plan to add some repulsion force in between each particles so that it looks more like a real-life fluid.

# Trivia
When we uncomment the line which caused the glitch before, something oddly aesthetic was displayed. 

![]({{ site.baseurl }}/images/physics-1.png)

Beautiful, isn't it? ^^